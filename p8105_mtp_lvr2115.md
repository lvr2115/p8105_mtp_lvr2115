p8105_mtp_lvr2115
================
Laura Robles-Torres
2023-10-18

# Introduction

The data being imported and cleaned are from Change of Address (COAs)
forms received by the United States Post Office in New York City between
2018 and 2022. They include the total number of COAs to and from each
NYC zip code for each month of those 5 years. These COAs are filed by
people who are moving to ensure that mail is delivered to their new
address. There is another dataset being worked on that includes zipcode,
neighborhood, and county data for New York City.

## Problem 1

Given that in some cases the borough name and the county name differ, a
dataset with neighborhood data called `zipcodes` is imported and tidied.
A new variable `borough` is created in this dataset to accurately
reflect where borough each zipcode is located in.

``` r
zipcodes = 
  read_csv("./zip codes.csv") |> #import dataset
  janitor::clean_names() |> #clean var names
  mutate(
    borough = recode(county_name, 
                     "Bronx" = "The Bronx",
                     "Kings" = "Brooklyn",
                     "New York" = "Manhattan",
                     "Richmond" = "Staten Island") #create borough var based on county
)
```

    ## Rows: 324 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County Name, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Given that the data from COAs for each year is in a different Excel
sheet, each sheet is exported and cleaned before being combined via
`bind_rows` into a dataset called `combined_coa`. Variables
`total_perm_in` and `total_perm_out`indicate the total number of
permanent address changes going into and out of each zip code,
respectively. `month_num` is renamed as `month`. Additionally, a `year`
variable is created by separating `month` into year, number of the
corresponding month, and day.

``` r
coa_2018 = 
  readxl::read_excel("./USPS CHANGE OF ADDRESS NYC.xlsx", sheet = "2018") |> #import dataset
  janitor::clean_names() |> #clean var names
  separate(month, into = c("year", "month_num", "day"), convert = TRUE) |> 
  rename(month = month_num) #create year var
  
coa_2019 = 
  readxl::read_excel("./USPS CHANGE OF ADDRESS NYC.xlsx", sheet = "2019") |> #import dataset
  janitor::clean_names() |> #clean var names
  separate(month, into = c("year", "month_num", "day"), convert = TRUE) |> 
  rename(month = month_num) #create year var
   
coa_2020 = 
  readxl::read_excel("./USPS CHANGE OF ADDRESS NYC.xlsx", sheet = "2020") |> #import dataset
  janitor::clean_names() |> #clean var names
  separate(month, into = c("year", "month_num", "day"), convert = TRUE) |> 
  rename(month = month_num) #create year var

coa_2021 = 
  readxl::read_excel("./USPS CHANGE OF ADDRESS NYC.xlsx", sheet = "2021") |> #import dataset
  janitor::clean_names() |> #clean var names
  separate(month, into = c("year", "month_num", "day"), convert = TRUE) |> 
  rename(month = month_num) #create year var

coa_2022 = 
  readxl::read_excel("./USPS CHANGE OF ADDRESS NYC.xlsx", sheet = "2022") |> #import dataset
  janitor::clean_names() |> #clean var names
  separate(month, into = c("year", "month_num", "day"), convert = TRUE) |> 
  rename(month = month_num) #create year var
```

A new variable called `net_change`is created in each annual dataset that
subtracts each `total_perm_out` from each `total_perm_in` value to
reflect the increase or decrease in COAs that month and year. `month` is
recoded as a factor variable and replaced with the names of each month
instead of a number. Then, all of the annual datasets for COAs data from
years 2018 and 2022 were bound together and `zipcode` was re-named to
`zip_code` to match `zipcodes` and allow for merging.

``` r
combined_coa =
    bind_rows(coa_2018, coa_2019, coa_2020,coa_2021,coa_2022) |>
  rename("zip_code"="zipcode") |> 
  mutate(
  net_change = total_perm_in - total_perm_out, #Create net_change var 
  month = case_match(month,
      1 ~ "January",
      2 ~ "February",
      3 ~ "March",
      4 ~ "April",
      5 ~ "May",
      6 ~ "June",
      7 ~ "July",
      8 ~ "August",
      9 ~ "September",
      10 ~ "October",
      11 ~ "November",
      12 ~ "December"),
  month = as.factor(month) #recode month into month names
)#combine COA data from all sheets belonging to different years
```

Merging `combined_coa` with `zipcodes`:

``` r
merged_coazips = 
  inner_join(zipcodes, combined_coa, by="zip_code") |> #merge COA with zipcode datasets 
  select(everything(), -county_name, -state_fips, -file_date, -day, -starts_with("county")) 

str(merged_coazips) 
```

    ## tibble [12,085 × 9] (S3: tbl_df/tbl/data.frame)
    ##  $ zip_code      : num [1:12085] 10451 10451 10451 10451 10451 ...
    ##  $ neighborhood  : chr [1:12085] "High Bridge and Morrisania" "High Bridge and Morrisania" "High Bridge and Morrisania" "High Bridge and Morrisania" ...
    ##  $ borough       : chr [1:12085] "The Bronx" "The Bronx" "The Bronx" "The Bronx" ...
    ##  $ year          : int [1:12085] 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 ...
    ##  $ month         : Factor w/ 12 levels "April","August",..: 5 4 8 1 9 7 6 2 12 11 ...
    ##  $ city          : chr [1:12085] "BRONX" "BRONX" "BRONX" "BRONX" ...
    ##  $ total_perm_out: num [1:12085] 263 197 219 207 240 220 215 238 209 219 ...
    ##  $ total_perm_in : num [1:12085] 193 172 204 180 228 249 264 277 268 217 ...
    ##  $ net_change    : num [1:12085] -70 -25 -15 -27 -12 29 49 39 59 -2 ...

The final tidy dataset `merged_coazips` has 12085 observations and 9
variables and tells us about the net change in COAs for a given year
from years 2018 to 2022.

In the merged dataset total, there are 237 zipcodes found and 43 unique
neighborhoods.

### This table shows the most common cities represented in the data from Manhattan.

``` r
merged_coazips |> 
  filter(borough %in% c("Manhattan")) |>
  count(city) |> 
  mutate(rank = min_rank(desc(n))) |> 
  arrange(desc(n)) |>
  knitr::kable()
```

| city             |    n | rank |
|:-----------------|-----:|-----:|
| NEW YORK         | 3477 |    1 |
| BRONX            |   60 |    2 |
| BROOKLYN         |   59 |    3 |
| CANAL STREET     |    4 |    4 |
| ROOSEVELT ISL    |    4 |    4 |
| ROOSEVELT ISLAND |    4 |    4 |
| BOWLING GREEN    |    1 |    7 |
| BROOKLYN HEIGHTS |    1 |    7 |
| NYC              |    1 |    7 |
| SECHEDATY        |    1 |    7 |
| WALL STREET      |    1 |    7 |

### This table shows the most common cities represented in the data from Queens.

``` r
merged_coazips |> 
  filter(borough %in% c("Queens")) |>
  count(city) |> 
  mutate(rank = min_rank(desc(n))) |> 
  arrange(desc(n)) |>
  knitr::kable()
```

| city                |   n | rank |
|:--------------------|----:|-----:|
| JAMAICA             | 372 |    1 |
| FLUSHING            | 309 |    2 |
| ASTORIA             | 230 |    3 |
| QUEENS VILLAGE      | 165 |    4 |
| BAYSIDE             | 135 |    5 |
| LONG ISLAND CITY    | 120 |    6 |
| EAST ELMHURST       | 117 |    7 |
| OZONE PARK          | 116 |    8 |
| FRESH MEADOWS       | 107 |    9 |
| FAR ROCKAWAY        | 102 |   10 |
| LITTLE NECK         |  79 |   11 |
| RIDGEWOOD           |  70 |   12 |
| FLORAL PARK         |  68 |   13 |
| ELMHURST            |  63 |   14 |
| KEW GARDENS         |  62 |   15 |
| BELLEROSE           |  60 |   16 |
| BROOKLYN            |  60 |   16 |
| COLLEGE POINT       |  60 |   16 |
| CORONA              |  60 |   16 |
| HOWARD BEACH        |  60 |   16 |
| REGO PARK           |  60 |   16 |
| FOREST HILLS        |  59 |   22 |
| HOLLIS              |  59 |   22 |
| ROSEDALE            |  59 |   22 |
| WOODHAVEN           |  59 |   22 |
| WOODSIDE            |  59 |   22 |
| CAMBRIA HEIGHTS     |  58 |   27 |
| MASPETH             |  58 |   27 |
| MIDDLE VILLAGE      |  58 |   27 |
| SAINT ALBANS        |  57 |   30 |
| ARVERNE             |  56 |   31 |
| JACKSON HEIGHTS     |  56 |   31 |
| WHITESTONE          |  55 |   33 |
| RICHMOND HILL       |  54 |   34 |
| GLEN OAKS           |  52 |   35 |
| SUNNYSIDE           |  51 |   36 |
| ROCKAWAY BEACH      |  49 |   37 |
| SOUTH OZONE PARK    |  49 |   37 |
| BREEZY POINT        |  47 |   39 |
| SOUTH RICHMOND HILL |  47 |   39 |
| ROCKAWAY PARK       |  40 |   41 |
| DOUGLASTON          |  39 |   42 |
| OAKLAND GARDENS     |  38 |   43 |
| SPRINGFIELD GARDENS |  30 |   44 |
| LAURELTON           |  28 |   45 |
| LONG IS CITY        |  19 |   46 |
| BRIARWOOD           |  16 |   47 |
| ROCKAWAY POINT      |  13 |   48 |
| BELLE HARBOR        |  11 |   49 |
| GLENDALE            |  11 |   49 |
| S RICHMOND HL       |   9 |   51 |
| QUEENS VLG          |   8 |   52 |
| S OZONE PARK        |   8 |   52 |
| BAYSIDE HILLS       |   6 |   54 |
| BROAD CHANNEL       |   5 |   55 |
| BEECHHURST          |   4 |   56 |
| KEW GARDENS HILLS   |   4 |   56 |
| NEPONSIT            |   4 |   56 |
| AUBURNDALE          |   2 |   59 |
| BELLEROSE MANOR     |   2 |   59 |
| SPRNGFLD GDNS       |   2 |   59 |
| CALVERTON           |   1 |   62 |
| CAMBRIA HTS         |   1 |   62 |
| JACKSON HTS         |   1 |   62 |
| MIDDLE VLG          |   1 |   62 |
| NEW YORK CITY       |   1 |   62 |
| ST ALBANS           |   1 |   62 |

\#?# Comment on the any data quality issues you observe. Everyones city
of NYC.

There are 60 months between 2018 and 2022, but many ZIP codes have fewer
than 60 observations; most of these are also missing neighborhood
values. Discuss why this might be the case, using a few concrete
examples as illustration. \#?#

## Problem 2

This table shows the average change in COAs in each borough and year.
Across all boroughs, except Staten Island, the average change in COAs is
the lowest in 2020, showing that there were significantly more changes
of

``` r
merged_coazips |>
  group_by(borough, year) |>
  summarize(mean_net_change = mean(net_change)) |>
  pivot_wider(
    names_from = year,
    values_from = mean_net_change
  ) |>
  knitr::kable(digits = 2)
```

    ## `summarise()` has grouped output by 'borough'. You can override using the
    ## `.groups` argument.

| borough       |   2018 |   2019 |    2020 |   2021 |   2022 |
|:--------------|-------:|-------:|--------:|-------:|-------:|
| Brooklyn      | -46.18 | -51.68 | -110.67 | -76.84 | -55.38 |
| Manhattan     | -39.80 | -52.54 | -127.70 | -39.47 | -46.18 |
| Queens        | -25.71 | -28.09 |  -46.55 | -43.30 | -29.28 |
| Staten Island |  -9.85 |  -9.12 |  -10.54 | -22.55 | -16.30 |
| The Bronx     | -46.30 | -48.02 |  -72.65 | -66.10 | -53.19 |

This table shows, across all observed data, the five lowest values of
net_change, including ZIP code, neighborhood, and the year and month.

``` r
merged_coazips |>
  arrange(net_change) |>
  slice(1:5) |>
  select(zip_code, neighborhood, month, year, net_change) |>
  knitr::kable()
```

| zip_code | neighborhood                  | month | year | net_change |
|---------:|:------------------------------|:------|-----:|-----------:|
|    10022 | Gramercy Park and Murray Hill | May   | 2020 |       -983 |
|    10009 | Lower East Side               | July  | 2020 |       -919 |
|    10016 | Gramercy Park and Murray Hill | June  | 2020 |       -907 |
|    10016 | Gramercy Park and Murray Hill | July  | 2020 |       -855 |
|    10009 | Lower East Side               | June  | 2020 |       -804 |

This table shows, across data observed before 2020, the five highest
values of net_change, including ZIP code, neighborhood, and the year and
month.

``` r
merged_coazips |>
  filter(year < 2020) |>
  arrange(desc(net_change)) |>
  slice(1:5) |>
  select(zip_code, neighborhood, month, year, net_change) |>
  knitr::kable()
```

| zip_code | neighborhood        | month | year | net_change |
|---------:|:--------------------|:------|-----:|-----------:|
|    11101 | Northwest Queens    | April | 2018 |        360 |
|    11101 | Northwest Queens    | June  | 2018 |        344 |
|    11101 | Northwest Queens    | May   | 2018 |        300 |
|    10001 | Chelsea and Clinton | July  | 2018 |        225 |
|    11201 | Northwest Brooklyn  | April | 2018 |        217 |

This plot shows neighborhood-level average net_change values
(i.e. averaging across ZIP codes within neighborhoods) against month
over all five years. Your plot should facilitate comparisons across
boroughs. Will this work? OR no?

``` r
neighborhood_avg =
  merged_coazips |> 
  group_by(borough, neighborhood, month) |> 
  summarize(avg_net_change = mean(net_change, na.rm = TRUE))
```

    ## `summarise()` has grouped output by 'borough', 'neighborhood'. You can override
    ## using the `.groups` argument.

``` r
neighborhood_avg |> 
  ggplot(aes(x = month, y = avg_net_change, color = borough)) + 
  geom_line() +
  labs(x = "Month", y = "Average Net Change", title = "Neighborhood-Level Average Net Change Over Time") +
  theme(axis.text.x = element_text(angle=90, vjust=0.5, hjust=1)) 
```

![](p8105_mtp_lvr2115_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->
